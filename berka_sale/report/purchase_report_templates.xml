<?xml version="1.0" encoding="UTF-8" ?>
<odoo>
    <template id="report_purchasequotation_document_qty_total" inherit_id="purchase.report_purchasequotation_document">
        <xpath expr="//t[@t-foreach='o.order_line']" position="after">
            <t t-set="total_qty" t-value="0"/>
            <t t-set="uoms" t-value="o.order_line.filtered(lambda x: not x.display_type).mapped('product_uom')"/>
            <t t-if="o.order_line.filtered(lambda x: not x.display_type)">
                <t t-set="total_qty" t-value="sum(o.order_line.filtered(lambda x: not x.display_type).mapped('product_qty'))"/>
            </t>
            <t t-if="total_qty">
                <tr class="'bg-200 font-weight-bold o_line_section'">
                    <td name="td_total_quantity" class="text-right" colspan="4">
                        <span t-esc="total_qty"/>
                        <t t-if="uoms">
                            <t t-if="len(set(uoms)) == 1">
                                <span t-esc="uoms[0].name" groups="uom.group_uom"/>
                            </t>
                            <t t-else="">
                                <span t-esc="uoms[-1].name" style="opacity: 0;" groups="uom.group_uom"/>
                            </t>
                        </t>
                    </td>
                </tr>
            </t>
        </xpath>
    </template>

    <template id="report_purchaseorder_document_qty_total" inherit_id="purchase.report_purchaseorder_document">
        <xpath expr="//t[@t-foreach='o.order_line']" position="after">
            <t t-set="total_qty" t-value="0"/>
            <t t-set="uoms" t-value="o.order_line.filtered(lambda x: not x.display_type).mapped('product_uom')"/>
            <t t-if="o.order_line.filtered(lambda x: not x.display_type)">
                <t t-set="total_qty" t-value="sum(o.order_line.filtered(lambda x: not x.display_type).mapped('product_qty'))"/>
            </t>
            <t t-if="total_qty">
                <tr class="'bg-200 font-weight-bold o_line_section'">
                    <td name="td_total_quantity" class="text-right" colspan="4">
                        <span t-esc="total_qty"/>
                        <t t-if="uoms">
                            <t t-if="len(set(uoms)) == 1">
                                <span t-esc="uoms[0].name" groups="uom.group_uom"/>
                            </t>
                            <t t-else="">
                                <span t-esc="uoms[-1].name" style="opacity: 0;" groups="uom.group_uom"/>
                            </t>
                        </t>
                    </td>
                    <td colspan="2"/>
                </tr>
            </t>
        </xpath>
    </template>
</odoo>